本实验基于jpbc库实现，在运行项目之前需要首先下载jpbc库，并作如下配置：
1. 新建libraries，添加jpbc-api-2.0.0.jar和jpbc-plaf-2.0.0.jar两个jar包
2. 在modules中引入第一步建立的libraries

---

论文研读笔记如下：
# Threshold Ciphertext Policy Attribute-Based Encryption with Constant Size Ciphertexts

# **前置技术**

## **选择明文攻击（CPA）**

攻击者可以选择一些明文， 并观察相应的密文，然后利用这些已知明文和密文对之间的关系来破解密钥或其他敏感信息

## **选择密文攻击（CCA）**

攻击者可以选择一些密文, 并观察相应的解密结果或其他反馈信息，然后利用这些已知密文和对应的反馈信息来破解密钥或其他敏感信息。

## **基于属性的加密（ABE）**

基于属性的加密是一种高级加密技术，允许数据的访问控制基于属性而不是传统的用户或角色。属性基加密的思想是让密文和密钥与属性集合和访问结构产生关联，当且仅当属性集合满足访问结构的时候，方能解密成功。那么根据这其中两两的对应关系，又可以将属性基加密分为两类，即密钥策略属性基加密（KP-ABE）和密文策略属性基加密（CP-ABE）。

## **密文策略属性基加密（CP-ABE）**

用户的密钥对应着一系列属性的集合，密文中蕴含着访问策略。CP-ABE 允许数据拥有者定义数据的访问策略，而用户被授予一组属性，只有在用户的属性满足数据的策略时，用户才能解密数据。细想下来，密文是主体，只有特定的密钥才能与之匹配，从而解密。

这种设计比较接近于现实中的应用场景，可以假象每个用户根据自身条件或者属性从属性机构得到密钥，数据的所有者定义灵活的访问策略，以确保只有经过授权的用户能够访问其数据。

## **密钥策略属性基加密（KP-ABE）**

与CP-ABE相反，用户的密钥中蕴含访问策略，密文中对应着一系列属性集合，当且仅当密文的属性集合满足用户密钥的访问结构时，用户才能解密成功。细想下来，用户是主体，只有特定的密文才能与之匹配，从而解密。

这种设计比较接近静态场景，此时密文用与其相关的属性加密存放在服务器上，当允许用户得到某些消息时，就分配一个特定的访问结构给用户。

## 双线性映射

一个双线性映射是由两个[向量空间](https://zh.wikipedia.org/wiki/%E5%90%91%E9%87%8F%E7%A9%BA%E9%97%B4 "向量空间")上的元素，生成第三个向量空间上一个元素之函数，并且该函数对每个参数都是线性的。[双线性映射-维基百科](https://zh.wikipedia.org/zh-hans/%E5%8F%8C%E7%BA%BF%E6%80%A7%E6%98%A0%E5%B0%84)

## Diffie-Hellman密钥交换协议

1. **参数选择**：首先，通信双方Alice和Bob共同协商一组公开参数，这些参数包括一个大质数p和一个生成元g。这些参数通常在密码学上是公开的，而不需要保密。p和g应该是足够大的素数，以增加协议的安全性。
    
2. **私钥生成**：Alice选择一个随机自然数a作为私钥，Bob选择一个随机自然数b作为私钥。私钥是保密的，并且只由生成它的一方知道。
    
3. **公开值计算**：Alice 计算公开值 A = g^a mod p，Bob 计算公开值 B = g^b mod p。
    
4. **公开值交换**：Alice和Bob将各自计算得到的公开值A和B发送给对方，这个交换过程可以在公开信道上进行，因为这些公开值本身并不透露有关私钥的信息。
    
5. **共享密钥生成**：Alice和Bob使用对方发送的公开值和自己的私钥来计算一个共享的密钥。具体地，Alice 计算共享密钥为 K = B^a mod p，Bob计算共享密钥为 K = A^b mod p。由于指数运算是可交换的，所以两方都将得到相同的共享密钥K。
    

* * *

# **1、Introduction**

## 背景

在大多数之前的ABE方案中（除了[8,11,24,2,6]），密文大小至少与访问策略中涉及的属性数量成线性关系。 ABE 方案中的配对计算次数也是如此。这些极大地限制了 ABE 在现实应用中的使用，特别是对于带宽问题非常重要的场景。因此，密文大小恒定的 CP-ABE 方案（即，无论底层属性的数量如何）是更可取的。

## 贡献

恒定大小密文的CP-ABE中存在三个开放问题：如何实现完全安全（即不仅仅是选择性安全）、标准模型中的CCA安全以及将安全性简化为更标准的数学问题。**本文解决了这三个开放问题中的最后两个。**

- 我们使用类似于[6]中使用的技术来将我们的方案扩展为CCA安全而不损失其效率
    
- 我们的 CP-ABE 方案针对选定明文攻击的安全性可以通过简化为决策 q-Bilinear Diffie-Hellman指数问题在标准模型中得到证明。
    

* * *

# 2、Preliminaries

## 符号表示

- 安全参数：λ
    
- 实数、整数：小写英文字母（p,q,x,y, etc.）
    
- 集合：大写英文字母（S,W, etc.）
    
- 加密算法中使用的访问结构：γ
    
- 如果x是字符串则它的长度表示为：|x|
    
- 如果S是集合则集合的大小表示为：|S|
    

可忽略函数：如果 k∈ℕ（自然数集合），∃k0∈ℕ, ∀k>k0, f(k)<1/kc(c>0且为常数) 则f(k)为可忽略函数。用更简单的术语来说，可忽略函数f(k)，对于所有足够大的k，函数的值无限趋近于零。

## 双线性群

设G，GT是素数阶为p的乘法循环群，G的生成元为g

双线性映射 e：G × G → GT 有如下特性：

- 双线性性：对所有的 u,v ∈ G 和 a,b ∈ Zp\*，有e(ua,vb) = e(u,v)ab
    
- 非退化性：e(g,g) ≠ 1
    
- 可计算性：对所有的u,v∈G都可以计算e(u,v)
    

## 难题假设

我们方案的安全性基于确定性q-BDHE问题，定义如下：

定义其中gi\=gai对一些未知的a∈Zp\*

输出b∈{0,1}的算法A具有e的概率解决确定性q-BDHE问题，满足如下等式其中概率取决于G中生成元g,h的随机选取，Zp\*中a的随机选取，GT中T的随机选取和B使用的随即比特

定义：如果没有一个时间复杂度为 t 的算法可以在 确定性q-BDHE问题中获得至少 e 的优势，那么我们认为确定性(t,e,q)-BDHE假设成立

## CP-ABE方法

CP-ABE系统中的**两个实体**：

- 中央属性机构：管理属性密钥，每个用户都从中央属性机构接收与他所满足的属性相对应的密钥。
    
- 用户
    

**符号表示**：

- U：属性域
    
- γ：访问结构，γ是属性域U上的布尔函数，给定属性集 A ⊆ U ，函数返回0或1。当且仅当 γ(A) = 1 时，A满足γ
    

**门限策略：**

本论文中使用的访问结构采用门限策略，选择一个属性集 S ⊆ U 以及一个门限t（1 ≤ t ≤ |S|），只有当用户的属性集A中含有属性集S中的t个及以上的属性时才满足访问策略。

**基础算法：**

- Setup(λ,U)：将安全参数λ和属性集U作为输入，返回公共参数和主密钥msk，主密钥msk由中央机构保密，用于生成用户密钥，公共参数(包含属性集合U)是公开的。
    
- KeyGen(msk,params,A)：将主密钥msk、公共参数params和用户的属性集A (A ⊆ U)作为输入，返回属性密钥SKA。
    
- Encrypt(M,params,γ)：将消息M、公共参数params和访问结构γ作为输入，返回密文CT，只有用户的属性集A满足γ时才能解密CT。
    
- Decrypt(params,γ,SKA,CT)：将公共参数params、访问结构γ、密文CT和属性集A的密钥SKA作为输入，如果密文无效则返回“⊥”，如果属性集A满足访问机构γ则返回消息M。
    
- (optional)Delegate(SKA,A’ ⊆ A)：将属性集A的私钥SKA和子集A’ ⊆ A作为输入，返回属性集A’的私钥SKA‘。
    

**安全模型：**

抵抗CPA攻击的安全模型（挑战者C和敌手A）

- Setup
    
    挑战者C选取安全参数λ，执行Setup算法生成主密钥msk和公共参数params
    
    C将params给敌手A，保密msk
    
- Phase1
    
    敌手A向挑战者C查询属性A1,…,AqK1的密钥
    
- Challenge
    
    敌手A声明两个等长的消息M0和M1和访问结构Y\*，任意的查询属性集A1,…,AqK1都不满足访问结构Y\*
    
    挑战者C随机选取β∈{0,1}，然后在访问结构Y\*下加密Mβ，并将密文CT\*返回给敌手A
    
- Phase2
    
    敌手A再向挑战者C查询属性AqK1+1,…,AqK的密钥，这些属性都不满足Y\*
    
- Guess
    
    敌手A给出他所猜测的β的值β’
    

如果β’=β则说明敌手A成功，敌手A的胜率为：

定义：CP-ABE方案(t,e,qK)-CPA是安全的，如果敌手A的胜率对每一个时间复杂度为t总共进行qK次密钥查询的敌手A可以忽略不计，我们有AdvCPAA,CP-ABE≤e。如果对于所有的多项式限制t，qK，胜率e都是可忽略的，那么CP-ABE方案就是CPA安全的。

* * *

# 3、本文的CP-ABE方案

## CPA安全的CP-ABE方案

G ：素数阶为p生成元为g的双线性群

e：G×G→GT 是双线性映射

**Setup(λ,U)**

输入：安全参数λ，属性集合U={att1,att2,…,attl}

输出：主密钥msk = x，公共参数params = (g,g2,Z,h0,h1,…,h2l-1)

1. 中央属性机构选择编码函数ρ，将l个属性中的每一个属性atti编码为不同的元素 ρ(atti) = xi ∈ Zp，简单来说就是定义 ρ(atti) = i 对每一个atti ∈ U
    
2. 除了U中的l个属性外，属性机构还需要选取 l - 1 个默认属性U’ = {att’1,att’2,…,att’l-1} = {l+1,…,2l - 1}。系统中的每个用户都拥有默认属性U’(|U’| = l - 1)。
    
3. 中央属性机构从G中随即均匀的选择 g2,h0,h1,…,h2l-1, 选择随机数 x ∈ Zp\*
    
4. 计算 g1 = gx，Z = e(g1,g2)
    
5. 主密钥msk = x，公共参数params = (g,g2,Z,h0,h1,…,h2l-1)
    

**KeyGen(msk,params,A)**

属性机构采取下列步骤为属性集A ⊆ U 的用户生成私钥

输入：主密钥msk=x，公共参数params，用户属性集A

输出：用户私钥{ski}i∈A∪U’

1. 随机选取l-1次多项式q(·)，其中q(0) = x
    
2. 对每一个属性 i ∈ (A ∪ U’)，属性机构从Zp中选取随机数ri，计算
    
    ski =(g2q(i)(h0hi)ri , gri , h1ri , ... , hi−1ri , hi+1ri , ... , h2l-1ri)
    
        =(ai , bi , ci,1 , ... , ci,i−1 , ci,i+1 , ... , ci,2l−1);
    
3. 属性机构输出私钥{ski}i∈A∪U’
    

**Delegate(SKA , A’⊆A)**

输入：属性集A⊆U的私钥SKA，属性集A的子集A’⊆A

输出：新用户私钥{ski}i∈A’∪U’

1. 对每一个 i∈A′∪U′ 选择随机数 ri
    
2. 生成新私钥 SKA’ = {ski}i∈A′∪U′
    
    ski \=(ai , bi , ci,1 , ... , ci,i−1 , ci,i+1 , ... , ci,2l−1)
    
        =(ai(h0hi)ri , bigri , ci,1h1ri , ... , ci,i−1hi−1ri , ci,i+1hi+1ri , ... , ci,2l−1h2l-1ri)
    

**Encrypt(M,params,γt,S)**

发送者采取以下步骤加密消息M∈GT

输入：门限访问结构γt,S(S⊆U，1≤t≤|S|)

输出：密文CT

1. 发送者从默认属性集U’中挑选前l-t个元素Ω = {l+1,l+2,…,2l-t}
    
2. 发送者选择一个随机数s∈Zp，计算密文CT = (C0,C1,C2)
    

**Decrypt(params,γt,S,SKA,CT)**

任何拥有满足门限访问结构γt,S的属性集A的用户（也就是说存在子集A’ ⊆ A ∩ S，|A'| = t）都可以使用密钥{ski}i∈A’∪U’解密密文

输入：公共参数params，门限访问结构γt,S，用户私钥SKA，密文CT

输出：明文消息M

1. 用户从默认属性集U’中挑选前l-t个元素Ω = {l+1,l+2,…,2l-t}
    
2. 用户计算
    
3. 计算明文消息 M = C0 · e(C2,D2) / e(C1,D1)
    

* * *

## CCA安全的CP-ABE方案

**Setup(λ,U)**

1. 属性机构随机选取（δ1,δ2,δ3）∈ G ，和一个抗碰撞哈希函数 H：{0,1}\* → Zp\*
    
2. 公共参数params = (g,g2,Z,h0,h1,…,h2l-1,δ1,δ2,δ3,H) 的其他部分和主密钥msk = x根据CPA安全方案中的Setup算法选取。
    

**KeyGen(msk,params,A)**

1. 本算法与CPA安全方案的KeyGen算法相同
    

**Delegate(SKA , A’⊆A)**

1. 本算法与CPA安全方案的Delegate算法相同
    

**Encrypt(M,params,γt,S)**

给定门限访问结构γt,S，发送者加密消息M∈GT的步骤如下

1. 发送者选取默认属性子集 Ω⊆U’，其元素为U’前 l-t 个元素，Ω={l+1,l+2,…,2l-t}
    
2. 发送者选取随机数 s,r∈Zp，计算
    
    其中c = H(γt,S,C0,C1,C2)
    
3. 发送者输出密文CT=(C0,C1,C2,C3,r)
    

**Decrypt(params,γt,S,SKA,CT)**

1. 假设CT是由γt,S加密的密文，用户需检查以下两个等式
    
    其中c = H(γt,S,C0,C1,C2) Ω={l+1,l+2,…,2l-t}（U’的前l-t个元素）
    
2. 如果两个等式中有一个不成立，则返回⊥
    
3. 反之，用户可以通过私钥 {ski}i∈A’∪U’ 按照CPA安全方案的Decrypt算法解密得到原文
    

* * *

# 4、安全分析

有些复杂，没太看懂

# 5、性能比较

对具有恒定大小密文的CP-ABE方案进行比较
